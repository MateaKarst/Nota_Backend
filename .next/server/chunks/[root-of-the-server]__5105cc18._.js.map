{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 108, "column": 0}, "map": {"version":3,"sources":["file:///D:/C/TM2024-25/Nota/Frontend/Nota_Backend/src/lib/supabase.ts"],"sourcesContent":["// src/lib/supabase.ts\r\nimport { createClient } from '@supabase/supabase-js'\r\n\r\nexport const supabase = createClient(\r\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\r\n);\r\n\r\nexport const supabaseAdmin = createClient(\r\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n    process.env.SUPABASE_SERVICE_ROLE_KEY!\r\n);\r\n"],"names":[],"mappings":"AAAA,sBAAsB;;;;;AACtB;;AAEO,MAAM,WAAW,CAAA,GAAA,yLAAA,CAAA,eAAY,AAAD;AAK5B,MAAM,gBAAgB,CAAA,GAAA,yLAAA,CAAA,eAAY,AAAD,gFAEpC,QAAQ,GAAG,CAAC,yBAAyB","debugId":null}},
    {"offset": {"line": 163, "column": 0}, "map": {"version":3,"sources":["file:///D:/C/TM2024-25/Nota/Frontend/Nota_Backend/src/utils/cors.ts"],"sourcesContent":["// src/utils/cors.ts\r\nimport { NextResponse } from 'next/server'\r\n\r\nconst allowedOrigins = [\r\n    // localhost browser\r\n    'http://localhost:3000',\r\n    'http://localhost:3001',\r\n    'http://localhost:3002',\r\n\r\n    // vio n mk network?\r\n    'http://192.168.1.38:3000',\r\n    'http://192.168.1.38:3001',\r\n    'http://192.168.1.38:3002',\r\n\r\n    // app sites\r\n    'https://nota-community.netlify.app',\r\n    'https://nota-backend-delta.vercel.app'\r\n]\r\n\r\nexport function handlePreflight(request: Request): NextResponse {\r\n    const origin = request.headers.get('origin') || '';\r\n    const headers: Record<string, string> = {\r\n        'Access-Control-Allow-Methods': 'GET, PATCH, POST, PUT, OPTIONS',\r\n        'Access-Control-Allow-Headers': 'Content-Type, Authorization, x-refresh-token, x-user-id',\r\n        'Access-Control-Allow-Credentials': 'true',\r\n    };\r\n\r\n    if (allowedOrigins.includes(origin)) {\r\n        headers['Access-Control-Allow-Origin'] = origin;\r\n    }\r\n\r\n    return new NextResponse(null, {\r\n        status: 204,\r\n        headers,\r\n    });\r\n}\r\n\r\nexport function addCorsHeaders(\r\n    request: Request,\r\n    response: NextResponse\r\n): NextResponse {\r\n    const origin = request.headers.get('origin') || ''\r\n    if (allowedOrigins.includes(origin)) {\r\n        response.headers.set('Access-Control-Allow-Origin', origin)\r\n        response.headers.set('Access-Control-Allow-Credentials', 'true')\r\n    }\r\n    return response\r\n}"],"names":[],"mappings":"AAAA,oBAAoB;;;;;AACpB;;AAEA,MAAM,iBAAiB;IACnB,oBAAoB;IACpB;IACA;IACA;IAEA,oBAAoB;IACpB;IACA;IACA;IAEA,YAAY;IACZ;IACA;CACH;AAEM,SAAS,gBAAgB,OAAgB;IAC5C,MAAM,SAAS,QAAQ,OAAO,CAAC,GAAG,CAAC,aAAa;IAChD,MAAM,UAAkC;QACpC,gCAAgC;QAChC,gCAAgC;QAChC,oCAAoC;IACxC;IAEA,IAAI,eAAe,QAAQ,CAAC,SAAS;QACjC,OAAO,CAAC,8BAA8B,GAAG;IAC7C;IAEA,OAAO,IAAI,gIAAA,CAAA,eAAY,CAAC,MAAM;QAC1B,QAAQ;QACR;IACJ;AACJ;AAEO,SAAS,eACZ,OAAgB,EAChB,QAAsB;IAEtB,MAAM,SAAS,QAAQ,OAAO,CAAC,GAAG,CAAC,aAAa;IAChD,IAAI,eAAe,QAAQ,CAAC,SAAS;QACjC,SAAS,OAAO,CAAC,GAAG,CAAC,+BAA+B;QACpD,SAAS,OAAO,CAAC,GAAG,CAAC,oCAAoC;IAC7D;IACA,OAAO;AACX","debugId":null}},
    {"offset": {"line": 212, "column": 0}, "map": {"version":3,"sources":["file:///D:/C/TM2024-25/Nota/Frontend/Nota_Backend/src/app/api/tracks/route.ts"],"sourcesContent":["import { NextResponse, NextRequest } from \"next/server\";\r\nimport { supabaseAdmin } from \"@/lib/supabase\";\r\nimport type { Instrument } from \"@/utils/interfaceTypes\";\r\nimport { parseBuffer } from \"music-metadata\";\r\nimport { addCorsHeaders, handlePreflight } from \"@/utils/cors\";\r\n\r\nfunction parseFloatOrNull(value: FormDataEntryValue | null): number | null {\r\n  if (!value) return null;\r\n  const num = parseFloat(value.toString());\r\n  return isNaN(num) ? null : num;\r\n}\r\n\r\nfunction parseJSONOrNull<T>(value: FormDataEntryValue | null): T | null {\r\n  if (!value) return null;\r\n  try {\r\n    return JSON.parse(value.toString());\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function OPTIONS(request: NextRequest) {\r\n  return handlePreflight(request);\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  const form = await request.formData();\r\n\r\n  const file = form.get(\"file\") as File | null;\r\n  const song_id = form.get(\"song_id\")?.toString();\r\n\r\n  if (!file || !song_id) {\r\n    const res = NextResponse.json({ message: \"Missing file or song_id\" }, { status: 400 });\r\n    return addCorsHeaders(request, res);\r\n  }\r\n\r\n  const filename = `${crypto.randomUUID()}-${file.name.toLowerCase()}`;\r\n  const fileName = file.name.toLowerCase();\r\n  const mimeType = file.type;\r\n\r\n  if (![\"audio/mpeg\"].includes(mimeType) || !fileName.endsWith(\".mp3\")) {\r\n    const res = NextResponse.json({ message: \"Only MP3 files are allowed\" }, { status: 400 });\r\n    return addCorsHeaders(request, res);\r\n  }\r\n\r\n  const buffer = Buffer.from(await file.arrayBuffer());\r\n\r\n  try {\r\n    const metadata = await parseBuffer(buffer, file.type);\r\n    const duration = metadata.format.duration ?? 0;\r\n\r\n    if (duration < 5) {\r\n      const res = NextResponse.json({ message: \"Track must be at least 5 seconds long\" }, { status: 400 });\r\n      return addCorsHeaders(request, res);\r\n    }\r\n\r\n    if (duration > 300) {\r\n      const res = NextResponse.json({ message: \"Track must be less than 5 minutes long\" }, { status: 400 });\r\n      return addCorsHeaders(request, res);\r\n    }\r\n  } catch (err) {\r\n    const res = NextResponse.json(\r\n      {\r\n        message: \"Failed to read audio metadata\",\r\n        error: (err as Error).message,\r\n      },\r\n      { status: 400 }\r\n    );\r\n    return addCorsHeaders(request, res);\r\n  }\r\n\r\n  const MAX_FILE_SIZE = 10 * 1024 * 1024; // 10 MB\r\n  if (file.size > MAX_FILE_SIZE) {\r\n    const res = NextResponse.json({ message: \"File is too large. Maximum size is 10MB.\" }, { status: 400 });\r\n    return addCorsHeaders(request, res);\r\n  }\r\n\r\n  const { error: uploadError } = await supabaseAdmin.storage\r\n    .from(\"tracks\")\r\n    .upload(filename, file, {\r\n      contentType: file.type,\r\n      upsert: true,\r\n    });\r\n\r\n  if (uploadError) {\r\n    const res = NextResponse.json({ message: \"Error uploading file\", error: uploadError.message }, { status: 500 });\r\n    return addCorsHeaders(request, res);\r\n  }\r\n\r\n  const publicUrl = supabaseAdmin.storage.from(\"tracks\").getPublicUrl(filename).data.publicUrl;\r\n\r\n  let instruments: Instrument[] | null = null;\r\n  const instrumentsRaw = form.get(\"instruments\");\r\n  if (instrumentsRaw) {\r\n    try {\r\n      const parsed = JSON.parse(instrumentsRaw.toString());\r\n      if (Array.isArray(parsed)) instruments = parsed;\r\n      else {\r\n        const res = NextResponse.json({ message: \"Invalid instruments array\" }, { status: 400 });\r\n        return addCorsHeaders(request, res);\r\n      }\r\n    } catch {\r\n      const res = NextResponse.json({ message: \"Invalid instruments JSON\" }, { status: 400 });\r\n      return addCorsHeaders(request, res);\r\n    }\r\n  }\r\n\r\n  const trackData = {\r\n    song_id,\r\n    url: publicUrl,\r\n    storage_path: filename,\r\n    start_position: parseFloatOrNull(form.get(\"start_position\")) ?? 0,\r\n    start_cue: parseFloatOrNull(form.get(\"start_cue\")),\r\n    end_cue: parseFloatOrNull(form.get(\"end_cue\")),\r\n    fade_in_end: parseFloatOrNull(form.get(\"fade_in_end\")),\r\n    fade_out_start: parseFloatOrNull(form.get(\"fade_out_start\")),\r\n    volume: parseFloatOrNull(form.get(\"volume\")) ?? 1.0,\r\n    draggable: form.get(\"draggable\")?.toString() === \"false\" ? false : true,\r\n    envelope: parseJSONOrNull(form.get(\"envelope\")),\r\n    intro: parseJSONOrNull(form.get(\"intro\")),\r\n    markers: parseJSONOrNull(form.get(\"markers\")),\r\n    wave_color: form.get(\"wave_color\")?.toString() || \"#2D2D2D\",\r\n    progress_color: form.get(\"progress_color\")?.toString() || \"#7C7C7C\",\r\n    instruments,\r\n  };\r\n\r\n  const { data: track, error } = await supabaseAdmin\r\n    .from(\"tracks\")\r\n    .insert([trackData])\r\n    .select()\r\n    .single();\r\n\r\n  if (error) {\r\n    const res = NextResponse.json({ message: \"Error saving track\", error: error.message }, { status: 500 });\r\n    return addCorsHeaders(request, res);\r\n  }\r\n\r\n  // Fetch the related song\r\n  const { data: song, error: songError } = await supabaseAdmin\r\n    .from(\"songs\")\r\n    .select(\"*\")\r\n    .eq(\"id\", song_id)\r\n    .single();\r\n\r\n  if (songError) {\r\n    const res = NextResponse.json(\r\n      {\r\n        message: \"Track created, but failed to fetch song\",\r\n        track,\r\n        error: songError.message,\r\n      },\r\n      { status: 207 }\r\n    );\r\n    return addCorsHeaders(request, res);\r\n  }\r\n\r\n  const res = NextResponse.json({ message: \"Track created\", track, song }, { status: 200 });\r\n  return addCorsHeaders(request, res);\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}